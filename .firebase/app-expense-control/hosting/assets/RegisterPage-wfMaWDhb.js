import{r as p,j as a,N as b,p as j,n as y,q as S,t as h,d as m,b as u,h as v,S as D}from"./index-Dm2Etmfk.js";import{u as N}from"./useAuthRequired-DpABRqPL.js";import{B as I}from"./BackgroundPage-uU6Txnod.js";import{I as d}from"./Input-o3ljYvfc.js";import{a as U}from"./Button-BpPl92Rm.js";const C=()=>{const[t,o]=p.useState({username:"",email:"",password:""}),[e,g]=p.useState({email:"",password:"",username:""}),c=s=>{const{name:n,value:r}=s.target;g({...e,[n]:r})},x=()=>{const s={};return(e.email.length<8||!/\S+@\S+\.\S+/.test(e.email))&&(s.email="Invalid email."),e.password.length<3&&(s.password="Password is too short."),(e.username.length<6||e.username.includes(" "))&&(s.username="Username must be at least 6 characters and not contain spaces."),o(s),s},f=async s=>{const n=m(u,"userData",s);return!(await v(n)).exists()},w=async s=>{s.preventDefault();const n=x();if(Object.keys(n).length>0){console.log(n);return}const r=e.username;if(!await f(r)){o(i=>({...i,username:"Username already in use. Please choose another one."})),console.log("Username already exists:",r);return}try{const l=(await j(y,e.email,e.password)).user;await S(l,{username:e.username}),await h(m(u,`userAuth/${l.uid}`),{uid:l.uid,email:e.email,password:e.password,displayName:"",username:r,registrationDate:new Date().toISOString(),providerId:l.providerData[0].providerId,rol:"user"}),await h(m(u,`userData/${r}`),{basicInf:{firstName:"",lastName:"",secondLastName:"",gender:"",birthDate:"",maritalStatus:"",profileDescription:"",website:"",language:"",socialMediaHandles:{twitter:"",linkedin:"",instagram:"",facebook:""}},contactInf:{phoneNumbers:{personal:""},email:e.email,emailPersonal:"",username:r,password:e.password,address:{region:"",country:"",mexicoState:"",currentCity:"",nearestAirport:""}},expenseControl:{budget:"",currency:"",cutoffDay:""},paymentTypes:{cash:"cash"},uid:l.uid,registrationDate:new Date().toISOString()})}catch(i){console.error("Error creating user:",i),o({general:i.message})}};return a.jsxs("form",{className:"flex-center flex-col p-6 rounded-xl w-10/12 bg-white -mt-60 mb-60",children:[a.jsx("h1",{className:"text-xl font-semibold mb-3 text-main-dark",children:"Registrarse"}),a.jsxs("div",{className:"w-full flex flex-wrap",children:[a.jsx(d,{name:"email",value:e.email,onChange:c,placeholder:"Correo electrónico",type:"email",classIcon:"bg-white/50"}),t.email&&a.jsx("span",{className:"text-sm text-red-600",children:t.email}),a.jsx(d,{name:"password",value:e.password,onChange:c,placeholder:"Contraseña",type:"password",classIcon:"bg-white/50"}),a.jsx(d,{name:"username",value:e.username,onChange:c,placeholder:"Username",type:"text",classIcon:"bg-white/50"}),t.general&&a.jsx("span",{className:"text-sm text-red-600",children:t.general})]}),a.jsx("div",{className:"w-full my-3 flex-center",children:a.jsx(U,{text:"Registrar",onClick:w})}),a.jsx(b,{to:"/login",className:"text-sm text-main-dark hover:underline",children:"Tengo una cuenta"})]})},B=()=>{const{isLoading:t,isAuthenticated:o}=N("/register","/");return t?a.jsx(D,{bgTheme:!0}):o?null:a.jsx(I,{children:a.jsx(C,{})})};export{B as default};
