import{r as c,U as de,u as me,j as e,S as ue,N as $,I as g,a as pe,s as xe,b as ge,g as he,d as fe,c as _,e as ye,f as be,h as je}from"./index-WWc8y-UN.js";import{u as we}from"./useAuthRequired-Co0d41S0.js";import{P as z,C as Ne,A as ve,p as De,a as Ce,b as Fe,L as Se,c as ke,d as $e,e as Me,B as Te}from"./index-DkO38PuL.js";import{x as Ie}from"./x_male_female_purple-CymKkZ1r.js";Ne.register(ve,De,Ce,Fe,Se,ke,$e,Me,Te);function Pe(){const{isAuthenticated:q}=we("/register","/"),{loading:v,userAuth:M,userData:t,state:a,setState:p}=c.useContext(de),[x,U]=c.useState(0),[J,Y]=c.useState([]),[H,W]=c.useState([]),[Z,K]=c.useState([]),[T,Q]=c.useState([]),[ee,te]=c.useState(0),[L,ae]=c.useState({}),[A,se]=c.useState({}),[h,X]=c.useState(!1),ne=t&&(t==null?void 0:t.profilePhoto)||"",V=me().pathname;c.useEffect(()=>{var k;if(!t||!a.gastos||!a.ingresos||v)return;const s=parseInt((k=t==null?void 0:t.expenseControl)==null?void 0:k.cutoffDay,10)||12,n=new Date,d=n.getDate(),m=n.getMonth(),y=n.getFullYear(),u=new Date(y,m-(d<s?1:0),s),j=new Date(u.getFullYear(),u.getMonth()+1,s-1,23,59,59),w=a.gastos.filter(r=>{const l=r.createdAt instanceof Date?r.createdAt:r.createdAt.toDate();return l>=u&&l<=j}),B=w.reduce((r,l)=>(r[l.type]||(r[l.type]=0),r[l.type]+=parseFloat(l.gasto)||0,r),{}),N=w.reduce((r,l)=>(r[l.category]||(r[l.category]=0),r[l.category]+=parseFloat(l.gasto)||0,r),{}),F=Object.keys(B),o=Object.values(B),b=Object.keys(N),S=Object.values(N),E={labels:F,datasets:[{label:"Gastos por Tipo de Pago",data:o,backgroundColor:["#495867","#495867","#495867","#495867","#495867"],borderColor:"#fff",borderWidth:1}]};W(o),K(F),Q(E),Y(w),U(w.reduce((r,l)=>r+(parseFloat(l.gasto)||0),0)),se({labels:b,datasets:[{label:"Gastos por Categoría",data:S,backgroundColor:["#D3D6DB","#D3D6DB","#D3D6DB","#D3D6DB","#D3D6DB"],borderColor:"#fff",borderWidth:1}]});const i=a.ingresos.reduce((r,l)=>(r[l.category]||(r[l.category]=0),r[l.category]+=parseFloat(l.ingreso)||0,r),{}),P=Object.keys(i),O=Object.values(i);ae({labels:P,datasets:[{label:"Ingresos por Categoría",data:O,backgroundColor:["#D3D6DB","#D3D6DB","#D3D6DB","#D3D6DB","#D3D6DB"],borderColor:"#fff",borderWidth:1}]});const G=a.ingresos.filter(r=>{const l=r.createdAt instanceof Date?r.createdAt:r.createdAt.toDate();return l>=u&&l<=j});te(G.reduce((r,l)=>r+(parseFloat(l.ingreso)||0),0))},[a.gastos,a.ingresos,t,v]),c.useEffect(()=>(a.isModalOpen?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[a.isModalOpen]);const R=()=>p(s=>({...s,isModalOpen:!0})),re=()=>p(s=>({...s,isModalOpen:!1})),le=s=>{const n=s.replace(/[^0-9]/g,"");return n.length===0?"":(parseFloat(n)/100).toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})},f=s=>{const{name:n,type:d,value:m,files:y}=s.target;if(d==="file")p(u=>({...u,[n]:y[0]}));else{const u=n==="gasto"||n==="ingreso"?le(m):m;p(j=>({...j,[n]:u}))}},oe=s=>{const{name:n}=s.target,d=a[n].replace(/[^0-9]/g,""),m=d.length===0?"":parseFloat(d)/100;p(y=>({...y,[n]:m.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}))},ie=async(s,n=!1)=>{var F;s.preventDefault(),p(o=>({...o,isSubmitting:!0}));const d=parseFloat((a[n?"ingreso":"gasto"]||"").toString().replace(/[^0-9.-]+/g,""));if(isNaN(d)||d<=0){p(o=>({...o,error:`Por favor, ingresa un ${n?"ingreso":"gasto"} válido.`,isSubmitting:!1})),console.log("ingreso");return}const m=a.date?new Date(a.date+"T00:00:00"):new Date,y=m.getFullYear(),u=m.getMonth(),j=m.getDate(),w=(t==null?void 0:t.expenseControl.cutoffDay)||1,B=String(y);let N="";j<w?N=["diciembreEnero","eneroFebrero","febreroMarzo","marzoAbril","abrilMayo","mayoJunio","junioJulio","julioAgosto","agostoSeptiembre","septiembreOctubre","octubreNoviembre","noviembreDiciembre"][u]||"desconocido":N=["eneroFebrero","febreroMarzo","marzoAbril","abrilMayo","mayoJunio","junioJulio","julioAgosto","agostoSeptiembre","septiembreOctubre","octubreNoviembre","noviembreDiciembre","diciembreEnero"][u]||"desconocido";try{let o=a.fileURL,b;if(a.file){const i=new Date,P=`${String(i.getFullYear()).slice(2)}${String(i.getMonth()+1).padStart(2,"0")}${String(i.getDate()).padStart(2,"0")}`,O=`${String(i.getHours()).padStart(2,"0")}${String(i.getMinutes()).padStart(2,"0")}${String(i.getSeconds()).padStart(2,"0")}`,G=a.file.name.replace(/[^a-zA-Z0-9.]/g,"_");b=`IMG_${P}-EC${O}.${G.split(".").pop()}`;const k=pe(xe,`userFiles/${M.username}/${b}`);try{await ge(k,a.file),o=await he(k)}catch{throw new Error("No se pudo subir el archivo.")}}const S={[n?"ingreso":"gasto"]:d,title:a.title,remarks:a.remarks,type:a.type,category:a.category,user:M.username,createdAt:m,year:B,period:N};o&&(S.image={imageURL:o,name:b||((F=a.file)==null?void 0:F.name)||""});const E=n?"ingresos":"gastos";if(a.currentId){const i=fe(_,"userPosts",M.username,E,String(a.currentId));await ye(i,S)}else{const i=be(_,"userPosts",M.username,E);await je(i,S)}p(i=>({...i,[n?"ingreso":"gasto"]:"",title:"",remarks:"",category:"",type:"",file:null,isModalOpen:!1,error:"",currentId:null})),setTimeout(()=>V.reload(),1e3)}catch(o){console.error(`Error al guardar el ${n?"ingreso":"gasto"}: `,o),p(b=>({...b,error:`Error al guardar los datos: ${o.message}`,isSubmitting:!1}))}finally{p(o=>({...o,isSubmitting:!1}))}},D=!v&&t&&t.expenseControl&&t.expenseControl.budget,I=!v&&t&&t.expenseControl&&t.expenseControl.budget-x,C=I*100/D,ce=x*100/D;return a.loading?e.jsx(ue,{}):q?e.jsxs("div",{className:"mb-10",children:[e.jsx("section",{className:"w-full max-w-screen-sm py-3 flex items-center justify-end",children:e.jsx($,{to:!V.includes("profile")&&"profile",children:e.jsx("img",{src:ne||Ie,alt:"Profile",className:"w-12 h-12 rounded-full object-cover border"})})}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3 flex flex-col items-center",children:[e.jsx("p",{className:"leading-3 text-main-dark/50",children:"Gastos Totales"}),e.jsxs("h1",{className:"text-4xl font-bold text-main-dark my-1",children:["$",x.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:` ${D-x<0?"text-main-primary":"text-main-highlight"}`,children:new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(D-x.toFixed(2))})]}),e.jsxs("section",{className:"w-full max-w-screen-sm flex justify-between items-center gap-2 py-3",children:[e.jsxs("button",{onClick:()=>{X(!1),R()},className:"w-full flex-center gap-1 text-sm font-semibold bg-primary-nightshade/70 text-white rounded-3xl p-3 transition-colors duration-200 hover:bg-primary-nightshade",children:[e.jsx("i",{className:"flex-center w-6 h-6 rounded-full hover:scale-105",children:g.plus.fill("#FFFFFF")}),"Agregar Gasto"]}),e.jsxs("button",{onClick:()=>{X(!0),R()},className:"w-full flex-center gap-1 text-sm font-semibold bg-main-highlight/70 text-white rounded-3xl p-3 transition-colors duration-200 hover:bg-main-highlight",children:[e.jsx("i",{className:"flex-center w-6 h-6 rounded-full hover:scale-105",children:g.plus.fill("#FFFFFF")}),"Agregar Ingreso"]})]}),J.length>0&&e.jsxs("section",{className:"w-full max-w-screen-sm py-3",children:[e.jsx("h2",{className:"text-main-dark text-lg font-semibold mb-3",children:"Resumen Mensual"}),e.jsxs($,{to:"/expenses/all",className:"w-full flex gap-[4%] h-full rounded-3xl mb-3 bg-white",children:[e.jsxs("div",{className:"w-[48%] h-[130px] py-3 px-4 flex flex-col justify-between",children:[e.jsxs("p",{className:"w-full text-main-primary text-center flex gap-1 font-bold",children:[e.jsx("i",{className:"flex-center w-5 h-5 aspect-square",children:g.flame.fill("#C2185B")}),"Gastos"]}),e.jsxs("p",{className:`w-full font-semibold text-2xl mt-7 ${ce>100&&"text-primary-nightshade"}`,children:["$",x.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),e.jsx("span",{className:"text-xs ml-1 text-primary-slate/70",children:"gastado"})]})]}),e.jsx("div",{className:"w-[48%] h-[130px] max-h-[130px] p-4 rounded-3xl flex flex-col items-start",children:e.jsx("div",{className:"flex-grow flex-center w-full h-full pl-12",children:e.jsx(z,{data:A,options:{cutout:"55%",plugins:{tooltip:{callbacks:{label:s=>`${A.labels[s.dataIndex]}: $${A.datasets[0].data[s.dataIndex].toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}`}},legend:{display:!1}}}})})})]}),e.jsxs($,{to:"/incomes",className:"w-full flex gap-[4%] h-full rounded-3xl mb-3 bg-white",children:[e.jsxs("div",{className:"w-[48%] h-[130px] py-3 px-4 flex flex-col justify-between",children:[e.jsxs("p",{className:"w-full text-main-highlight/70 text-center flex gap-1 font-bold",children:[e.jsx("i",{className:"flex-center w-6 h-6",children:g.money.wings()}),"Ingresos"]}),e.jsxs("p",{className:"w-full font-semibold text-2xl mt-7",children:[`$${ee.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}`,e.jsx("span",{className:"text-xs text-primary-slate/70",children:" ganados"})]})]}),e.jsx("div",{className:"w-[48%] h-[130px] max-h-[130px] p-4 rounded-3xl flex flex-col items-start",children:e.jsx("div",{className:"flex-grow flex-center w-full h-full pl-12",children:e.jsx(z,{data:L,options:{cutout:"55%",plugins:{tooltip:{callbacks:{label:s=>`${L.labels[s.dataIndex]}: $${L.datasets[0].data[s.dataIndex].toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}`}},legend:{display:!1}}}})})})]}),e.jsxs("aside",{className:"w-full flex flex-wrap items-stretch gap-[4%]",children:[e.jsxs("div",{className:`flex flex-col bg-white rounded-3xl py-3 px-4 ${C<0?" hidden ":" w-[48%] max-w-[300px]"}`,children:[e.jsx("span",{className:"font-light text-xs text-primary-slate",children:"Presupuesto Libre"}),e.jsxs("span",{className:"font-semibold text-xl text-main-dark",children:[" ",new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(D-x)]})]}),e.jsxs($,{to:"/expenses/gastos",className:`flex flex-col bg-white rounded-3xl py-3 px-4 ${C<0?" items-start w-full":" w-[48%] max-w-[300px]"}`,children:[e.jsx("span",{className:"font-light text-xs text-primary-slate",children:"Gastos Totales"}),e.jsxs("span",{className:"font-semibold text-xl text-main-dark",children:["$",x.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),e.jsxs("aside",{className:"w-full flex flex-wrap items-stretch gap-[4%] my-3",children:[e.jsxs("div",{className:`${I<0?"bg-primary-platinum":"bg-white hidden"} ${C<0?"w-[48%] max-w-[300px]":"w-full"} rounded-3xl p-4 flex justify-between items-center`,children:[e.jsx("span",{className:"text-main-dark",children:"Saldo"}),e.jsx("span",{className:`${I<0?"text-main-primary":"text-main-highlight"} font-semibold`,children:new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(I)})]}),C<0&&e.jsxs("div",{className:"w-[48%] max-w-[300px] bg-primary-platinum rounded-3xl p-4 flex items-center justify-between gap-1 opacity-0 transform scale-95 transition-all duration-500 ease-out motion-safe:animate-fade-in",children:[e.jsx("i",{className:"flex-center w-6 h-6",children:g.alert.border("#C2185B")}),e.jsxs("span",{className:"text-sm text-main-primary",children:["Has gastado",e.jsx("span",{className:"text-base font-semibold text-main-primary",children:` ${C.toFixed(2)}% `}),"más de lo que deberías este mes."]})]})]}),e.jsx("aside",{className:"w-full flex flex-wrap items-start gap-[4%] mb-3",children:Z.map((s,n)=>e.jsx($,{to:"/expenses/payments",className:"w-[48%] max-w-[300px] mb-3",children:e.jsx("div",{className:"bg-white py-3 px-4 rounded-3xl h-full flex flex-col items-start",children:e.jsxs("div",{className:"flex-grow flex gap-4 w-full",children:[e.jsxs("p",{className:"flex flex-col items-start w-full",children:[e.jsxs("span",{className:"text-xs font-light capitalize text-main-dark",style:{color:T.datasets[0].backgroundColor[n]},children:[s==="card1"&&t.paymentTypes.card1,s==="card2"&&t.paymentTypes.card2,s==="card3"&&t.paymentTypes.card3,s==="card4"&&t.paymentTypes.card4,s==="card5"&&t.paymentTypes.card5,s==="other"&&t.paymentTypes.other,s==="cash"&&"Efectivo"]}),e.jsxs("span",{className:"text-xl font-semibold text-main-dark",children:["$",H[n].toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsx("i",{className:"flex-center w-9 h-9",children:s==="cash"&&g.money.border(T.datasets[0].backgroundColor[n])||s==="other"&&g.bitcoin.border(T.datasets[0].backgroundColor[n])||g.credit_card.border(T.datasets[0].backgroundColor[n])})]})})},s))})]}),a.isModalOpen&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-lg w-full h-[85vh] relative overflow-hidden",children:e.jsxs("form",{onSubmit:s=>ie(s,h),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:re,className:"p-2 text-main-primary",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:a.isSubmitting,className:"p-2 text-main-highlight rounded hover:bg-main-primary-dark transition",children:a.isSubmitting?"Guardando...":a.currentGastoId?"Actualizar":"Agregar"})]}),e.jsxs("div",{className:"px-2",children:[e.jsxs("hgroup",{className:"rounded-3xl py-2 px-4 mb-4 bg-main-light",children:[e.jsx("input",{name:"title",type:"text",placeholder:h?"Concepto del ingreso":"Concepto del gasto",value:a.title,onChange:f,className:"w-full py-2 bg-transparent outline-none border-b border-main-dark/20 text-main-dark placeholder:text-main-dark/50",required:!0}),e.jsxs("div",{className:"flex-center pt-2 py-2",children:["$",e.jsx("input",{name:h?"ingreso":"gasto",type:"text",placeholder:`$ $ ${h?"Ingreso":"Gasto"}`,value:a[h?"ingreso":"gasto"],onChange:f,onBlur:oe,className:"w-full pl-1 bg-transparent outline-none text-main-dark placeholder:text-main-dark/50",required:!0}),!v&&t&&t.expenseControl&&(t==null?void 0:t.expenseControl.currency)]})]}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("select",{name:"type",value:a.type,onChange:f,className:"w-full bg-transparent outline-none",required:!0,children:h?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Pago con"}),t.incomeControl.paymentTypes.type1&&e.jsx("option",{value:"type1",children:t.incomeControl.paymentTypes.type1}),t.incomeControl.paymentTypes.type2&&e.jsx("option",{value:"type2",children:t.incomeControl.paymentTypes.type2}),t.incomeControl.paymentTypes.type3&&e.jsx("option",{value:"type3",children:t.incomeControl.paymentTypes.type3}),t.incomeControl.paymentTypes.type4&&e.jsx("option",{value:"type4",children:t.incomeControl.paymentTypes.type4}),t.incomeControl.paymentTypes.type5&&e.jsx("option",{value:"type5",children:t.incomeControl.paymentTypes.type5}),t.incomeControl.paymentTypes.other&&e.jsx("option",{value:"other",children:t.incomeControl.paymentTypes.other}),e.jsx("option",{value:"cash",children:"Efectivo"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Pago con"}),t.paymentTypes.card1&&e.jsx("option",{value:"card1",children:t.paymentTypes.card1}),t.paymentTypes.card2&&e.jsx("option",{value:"card2",children:t.paymentTypes.card2}),t.paymentTypes.card3&&e.jsx("option",{value:"card3",children:t.paymentTypes.card3}),t.paymentTypes.card4&&e.jsx("option",{value:"card4",children:t.paymentTypes.card4}),t.paymentTypes.card5&&e.jsx("option",{value:"card5",children:t.paymentTypes.card5}),t.paymentTypes.other&&e.jsx("option",{value:"other",children:t.paymentTypes.other}),e.jsx("option",{value:"cash",children:"Efectivo"})]})})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsxs("select",{name:"category",value:a.category,onChange:f,className:"w-full bg-transparent outline-none",required:!0,children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Categorías"}),h?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"salary",children:"Salario"}),e.jsx("option",{value:"business",children:"Negocios"}),e.jsx("option",{value:"investment",children:"Inversiones"}),e.jsx("option",{value:"other",children:"Otros Ingresos"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"feeding",children:"Alimentación y Bebidas"}),e.jsx("option",{value:"transportation",children:"Transporte"}),e.jsx("option",{value:"health",children:"Salud y Bienestar"}),e.jsx("option",{value:"educationJob",children:"Educación o Trabajo"}),e.jsx("option",{value:"housing",children:"Vivienda"}),e.jsx("option",{value:"entertainment",children:"Entretenimiento y Ocio"}),e.jsx("option",{value:"personalCare",children:"Ropa y Cuidado Personal"})]})]})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("input",{id:"date",name:"date",type:"date",value:a.date,onChange:f,className:"w-full bg-transparent outline-none text-main-dark placeholder:text-main-dark/50"})}),!a.currentGastoId&&e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("input",{name:"file",type:"file",onChange:f,className:"w-full",accept:"image/*, .pdf"})}),e.jsx("textarea",{name:"remarks",placeholder:"Observaciones",value:a.remarks,onChange:f,rows:"4",className:"w-full rounded-3xl p-4 mb-4 outline-none bg-main-light"})]})]})})})]}):null}export{Pe as default};
