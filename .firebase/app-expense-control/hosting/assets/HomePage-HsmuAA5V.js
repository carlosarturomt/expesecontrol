import{r as u,U as D,j as e,S as j,I as X,a as E,s as G,u as O,g as L,c as R,d as $,b as I}from"./index-CfOF9bxd.js";import{u as U}from"./useAuthRequired-_VLSZWmH.js";function P(){const[g,y]=u.useState(null),{isAuthenticated:N}=U("/register","/"),{userAuth:p,userData:x,state:s,setState:l}=u.useContext(D),[c,k]=u.useState(0),v=()=>l(a=>({...a,isModalOpen:!0})),w=()=>l(a=>({...a,isModalOpen:!1}));u.useEffect(()=>{const a=s.gastos.reduce((n,r)=>n+(parseFloat(r.gasto)||0),0);k(a)},[s.gastos]),u.useEffect(()=>(s.isModalOpen?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[s.isModalOpen]);const M=a=>{const n=a.replace(/[^0-9]/g,"");return n.length===0?"":(parseFloat(n)/100).toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})},o=a=>{const{name:n,value:r}=a.target,d=n==="gasto"?M(r):r;l(m=>({...m,[n]:d}))},F=a=>{const{name:n}=a.target,r=s[n].replace(/[^0-9]/g,""),d=r.length===0?"":parseFloat(r)/100;l(m=>({...m,[n]:d.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}))},S=async a=>{a.preventDefault(),l(i=>({...i,isSubmitting:!0}));const n=parseFloat(s.gasto.replace(/[^0-9.-]+/g,""));if(isNaN(n)||n<=0){l(i=>({...i,error:"Por favor, ingresa un gasto válido.",isSubmitting:!1}));return}const r=s.date?new Date(s.date+"T00:00:00"):new Date,d=r.getFullYear(),m=r.getMonth(),A=r.getDate();let t="";if(A<12)switch(m){case 0:t="diciembreEnero";break;case 1:t="eneroFebrero";break;case 2:t="febreroMarzo";break;case 3:t="marzoAbril";break;case 4:t="abrilMayo";break;case 5:t="mayoJunio";break;case 6:t="junioJulio";break;case 7:t="julioAgosto";break;case 8:t="agostoSeptiembre";break;case 9:t="septiembreOctubre";break;case 10:t="octubreNoviembre";break;case 11:t="noviembreDiciembre";break;default:t="desconocido"}else switch(m){case 0:t="eneroFebrero";break;case 1:t="febreroMarzo";break;case 2:t="marzoAbril";break;case 3:t="abrilMayo";break;case 4:t="mayoJunio";break;case 5:t="junioJulio";break;case 6:t="julioAgosto";break;case 7:t="agostoSeptiembre";break;case 8:t="septiembreOctubre";break;case 9:t="octubreNoviembre";break;case 10:t="noviembreDiciembre";break;case 11:t="diciembreEnero";break;default:t="desconocido"}try{let i="";if(s.file){const h=E(G,`userFiles/${p.username}/${s.file.name}`);await O(h,s.file),i=await L(h)}const b=R($,"userPosts",p.username,"gastos",String(d),t);await I(b,{gasto:n,title:s.title,remarks:s.remarks,type:s.type,category:s.category,fileURL:i||"",user:p.username,createdAt:r}),l(h=>({...h,gasto:"",title:"",remarks:"",category:"",file:null,isModalOpen:!1,error:""}))}catch(i){console.error("Error al subir datos: ",i),l(b=>({...b,error:"Error al subir los datos: "+i.message,isSubmitting:!1}))}finally{l(i=>({...i,isSubmitting:!1}))}},f=(x&&x.budget)-c,C=a=>{y(g===a?null:a)};return s.loading?e.jsx(j,{}):N?e.jsxs("div",{children:[e.jsxs("section",{className:"w-full max-w-screen-sm mt-6 py-3 flex flex-col items-center",children:[e.jsx("p",{className:"text-main-dark/50",children:"Gastos Totales"}),e.jsxs("h1",{className:"text-4xl font-bold text-main-dark my-2",children:["$",c.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:`${f<0?"text-main-primary":"text-main-highlight"}`,children:new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(f.toFixed(2))})]}),e.jsx("section",{className:"w-full max-w-screen-sm flex justify-between items-center gap-2 py-3 px-6",children:e.jsxs("button",{onClick:v,className:"w-full flex-center gap-1 text-sm font-semibold bg-main-highlight/70 text-white rounded-3xl p-3 transition-colors duration-200 hover:bg-main-primary-dark",children:[e.jsx("i",{className:"flex-center w-6 h-6 rounded-full hover:scale-105",children:X.plus.fill("#FFFFFF")}),"Agregar Gasto"]})}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3",children:[e.jsx("h2",{className:"text-dark text-lg font-semibold mb-4",children:"Notificaciones"}),e.jsx("div",{className:"bg-main-warning rounded-3xl p-4",children:e.jsx("p",{className:"text-dark font-medium",children:"¡Alerta! Has superado tu presupuesto mensual en un 75.05%."})})]}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3",children:[e.jsx("h2",{className:"text-main-dark text-lg font-semibold mb-4",children:"Resumen Mensual"}),e.jsxs("div",{className:"bg-main-dark/5 rounded-3xl p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-main-dark",children:"Presupuesto"}),e.jsxs("span",{className:"text-main-dark font-semibold",children:[" ",new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(x.budget)]})]}),e.jsxs("div",{className:"bg-main-dark/5 rounded-3xl p-4 flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-main-dark",children:"Gastos Totales"}),e.jsxs("span",{className:"text-main-dark font-semibold",children:["-$",c.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:`${c<0?"bg-main-primary/40":"bg-main-highlight/40"} rounded-3xl p-4 flex justify-between items-center mt-2`,children:[e.jsx("span",{className:"text-main-dark",children:"Saldo Actual"}),e.jsx("span",{className:`${c<0?"text-main-primary":"text-main-dark"} font-semibold`,children:new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(x.budget-c)})]})]}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3 mb-20",children:[e.jsx("h2",{className:"text-main-dark text-lg font-semibold mb-4",children:"Últimos Gastos"}),e.jsx("ul",{className:"space-y-3",children:s.loading?e.jsx(j,{bgTheme:!0}):s.gastos.length>0?e.jsx("ul",{className:"space-y-3",children:s.gastos.sort((a,n)=>n.createdAt-a.createdAt).slice(0,6).map(a=>{const n=typeof a.createdAt=="number"?a.createdAt:parseInt(a.createdAt,10);return e.jsxs("li",{className:"flex flex-col bg-main-dark/5 rounded-3xl p-4 cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between items-center ",onClick:()=>C(a.id),children:[e.jsx("span",{className:"text-main-dark font-medium",children:a.title||"Gasto desconocido"}),e.jsxs("span",{className:"text-main-primary font-semibold",children:["-",new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(a.gasto)]})]}),g===a.id&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-main-dark",children:"Detalles del gasto:"}),e.jsx("p",{className:"text-main-dark",children:a.category||"Sin categoria"}),e.jsx("p",{className:"text-main-dark",children:a.type||"Sin tipo de gasto"}),e.jsx("p",{className:"text-main-dark",children:a.remarks||"Sin observaciones"}),e.jsx("p",{className:"text-main-dark",children:a.fileURL||"Sin archivo adjunto"}),e.jsxs("p",{className:"text-main-dark",children:["Fecha: ",new Date(n).toLocaleString("es-MX",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})]})]})]},a.id)})}):e.jsx("li",{className:"flex justify-between items-center bg-main-dark/5 rounded-3xl p-4",children:e.jsx("span",{className:"text-main-dark font-medium",children:"No hay gastos registrados"})})})]}),s.isModalOpen&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-lg w-full h-[85vh] relative overflow-hidden",children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:w,className:"p-2 text-main-primary",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:s.isSubmitting,className:"p-2 text-main-highlight rounded hover:bg-main-primary-dark transition",children:s.isSubmitting?"Guardando...":"Agregar"})]}),e.jsxs("div",{className:"px-2",children:[e.jsxs("hgroup",{className:"rounded-3xl py-2 px-4 mb-4 bg-main-light",children:[e.jsx("input",{name:"title",type:"text",placeholder:"Concepto",value:s.title,onChange:o,className:"w-full py-2 bg-transparent outline-none border-b border-main-dark/20 text-main-dark placeholder:text-main-dark/50",required:!0}),e.jsxs("div",{className:"flex-center pt-2 py-2",children:["$",e.jsx("input",{name:"gasto",type:"text",placeholder:"$ $",value:s.gasto,onChange:o,onBlur:F,className:"w-full pl-1 bg-transparent outline-none text-main-dark placeholder:text-main-dark/50",required:!0}),"MXN"]})]}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsxs("select",{name:"type",value:s.type,onChange:o,className:"w-full bg-transparent outline-none",children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Pago con"}),e.jsx("option",{value:"likeU",children:"LikeU"}),e.jsx("option",{value:"AMEX",children:"AMEX"}),e.jsx("option",{value:"cash",children:"Efectivo"})]})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsxs("select",{name:"category",value:s.category,onChange:o,className:"w-full bg-transparent outline-none",children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Categorías"}),e.jsx("option",{value:"feeding",children:"Alimentación y Bebidas"}),e.jsx("option",{value:"transportation",children:"Transporte"}),e.jsx("option",{value:"health",children:"Salud y Bienestar"}),e.jsx("option",{value:"educationJob",children:"Gastos de Educación o Trabajo"}),e.jsx("option",{value:"housing",children:"Vivienda"}),e.jsx("option",{value:"entertainment",children:"Entretenimiento y Ocio"}),e.jsx("option",{value:"personalCare",children:"Ropa y Cuidado Personal"})]})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("input",{id:"date",name:"date",type:"date",value:s.date,onChange:o,className:"w-full bg-transparent outline-none text-main-dark placeholder:text-main-dark/50"})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("input",{name:"file",type:"file",onChange:o,className:"w-full",accept:"image/*, .pdf"})}),e.jsx("textarea",{name:"remarks",placeholder:"Observaciones",value:s.remarks,onChange:o,rows:"4",className:"w-full rounded-3xl p-4 mb-4 outline-none bg-main-light"})]})]})})})]}):null}export{P as default};
