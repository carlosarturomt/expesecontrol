import{r as b,U as L,j as e,S as w,I as T,d as j,a as y,g as U,b as P,c as V,s as z,u as B,e as J,f as q,h as H,i as Y}from"./index-C8yXicjq.js";import{u as _}from"./useAuthRequired-DiAk-HAF.js";import{S as K}from"./Button-CHVGdbyp.js";function ae(){const{isAuthenticated:S}=_("/register","/"),{userAuth:g,userData:h,state:a,setState:c}=b.useContext(L),[x,D]=b.useState(0),[Q,M]=b.useState(["Tarea 1","Tarea 2","Tarea 3"]),[k,F]=b.useState(null),C=t=>{F(k===t?null:t)},A=async(t,r,n)=>{try{const d=j(y,"userPosts",g.username,"gastos",t,r,n),o=await U(d);if(o.exists()){const i=o.data();c(m=>({...m,gasto:i.gasto||"",title:i.title||"",remarks:i.remarks||"",category:i.category||"",type:i.type||"",date:i.createdAt?i.createdAt.toDate().toISOString().substring(0,10):"",fileURL:i.fileURL||"",isModalOpen:!0,currentGastoId:n}))}else console.error("No se encontró el gasto para editar.")}catch(d){console.error("Error al obtener los datos del gasto:",d)}},E=async(t,r,n)=>{if(console.log(t,r,n),window.confirm(`¿Estás seguro de que deseas eliminar el gasto con ID: ${n}?`))try{const o=j(y,"userPosts",g.username,"gastos",t,r,n);await P(o),console.log(`Gasto con ID: ${n} eliminado.`),M(i=>i.filter(m=>m.id!==n))}catch(o){console.error("Error al eliminar el gasto: ",o)}},G=()=>c(t=>({...t,isModalOpen:!0})),I=()=>c(t=>({...t,isModalOpen:!1}));b.useEffect(()=>{const t=a.gastos.reduce((r,n)=>r+(parseFloat(n.gasto)||0),0);D(t)},[a.gastos]),b.useEffect(()=>(a.isModalOpen?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[a.isModalOpen]);const R=t=>{const r=t.replace(/[^0-9]/g,"");return r.length===0?"":(parseFloat(r)/100).toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})},p=t=>{const{name:r,type:n,value:d,files:o}=t.target;if(n==="file")c(i=>({...i,[r]:o[0]}));else{const i=r==="gasto"?R(d):d;c(m=>({...m,[r]:i}))}},$=t=>{const{name:r}=t.target,n=a[r].replace(/[^0-9]/g,""),d=n.length===0?"":parseFloat(n)/100;c(o=>({...o,[r]:d.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}))},O=async t=>{t.preventDefault(),c(l=>({...l,isSubmitting:!0}));const r=parseFloat((a.gasto||"").toString().replace(/[^0-9.-]+/g,""));if(isNaN(r)||r<=0){c(l=>({...l,error:"Por favor, ingresa un gasto válido.",isSubmitting:!1}));return}const n=a.date?new Date(a.date+"T00:00:00"):new Date,d=n.getFullYear(),o=n.getMonth(),i=n.getDate(),m=String(d);let s="";if(i<12)switch(o){case 0:s="diciembreEnero";break;case 1:s="eneroFebrero";break;case 2:s="febreroMarzo";break;case 3:s="marzoAbril";break;case 4:s="abrilMayo";break;case 5:s="mayoJunio";break;case 6:s="junioJulio";break;case 7:s="julioAgosto";break;case 8:s="agostoSeptiembre";break;case 9:s="septiembreOctubre";break;case 10:s="octubreNoviembre";break;case 11:s="noviembreDiciembre";break;default:s="desconocido"}else switch(o){case 0:s="eneroFebrero";break;case 1:s="febreroMarzo";break;case 2:s="marzoAbril";break;case 3:s="abrilMayo";break;case 4:s="mayoJunio";break;case 5:s="junioJulio";break;case 6:s="julioAgosto";break;case 7:s="agostoSeptiembre";break;case 8:s="septiembreOctubre";break;case 9:s="octubreNoviembre";break;case 10:s="noviembreDiciembre";break;case 11:s="diciembreEnero";break;default:s="desconocido"}const f=String(s);try{let l="";if(a.file){const u=Date.now(),X=`${a.title}_${u}.${a.file.name.split(".").pop()}`,v=V(z,`userFiles/${g.username}/${X}`);await B(v,a.file),l=await J(v)}if(a.currentGastoId){const u=j(y,"userPosts",g.username,"gastos",m,f,String(a.currentGastoId));await q(u,{gasto:r,title:a.title,remarks:a.remarks,type:a.type,category:a.category,fileURL:l||"",user:g.username,createdAt:n,year:m,period:f})}else{const u=H(y,"userPosts",g.username,"gastos",m,f);await Y(u,{gasto:r,title:a.title,remarks:a.remarks,type:a.type,category:a.category,fileURL:l||"",user:g.username,createdAt:n,year:m,period:f})}c(u=>({...u,gasto:"",title:"",remarks:"",category:"",type:"",file:null,isModalOpen:!1,error:"",currentGastoId:null}))}catch(l){console.error("Error al subir datos: ",l),c(u=>({...u,error:"Error al subir los datos: "+l.message,isSubmitting:!1}))}finally{c(l=>({...l,isSubmitting:!1}))}},N=(h&&h.budget)-x;return a.loading?e.jsx(w,{}):S?e.jsxs("div",{children:[e.jsxs("section",{className:"w-full max-w-screen-sm mt-6 py-3 flex flex-col items-center",children:[e.jsx("p",{className:"text-main-dark/50",children:"Gastos Totales"}),e.jsxs("h1",{className:"text-4xl font-bold text-main-dark my-2",children:["$",x.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:`${N<0?"text-main-primary":"text-main-highlight"}`,children:new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(N.toFixed(2))})]}),e.jsx("section",{className:"w-full max-w-screen-sm flex justify-between items-center gap-2 py-3 px-6",children:e.jsxs("button",{onClick:G,className:"w-full flex-center gap-1 text-sm font-semibold bg-main-highlight/70 text-white rounded-3xl p-3 transition-colors duration-200 hover:bg-main-primary-dark",children:[e.jsx("i",{className:"flex-center w-6 h-6 rounded-full hover:scale-105",children:T.plus.fill("#FFFFFF")}),"Agregar Gasto"]})}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3",children:[e.jsx("h2",{className:"text-main-dark text-lg font-semibold mb-4",children:"Resumen Mensual"}),e.jsxs("div",{className:"bg-main-dark/5 rounded-3xl p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-main-dark",children:"Presupuesto"}),e.jsxs("span",{className:"text-main-dark font-semibold",children:[" ",new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(h.budget)]})]}),e.jsxs("div",{className:"bg-main-dark/5 rounded-3xl p-4 flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-main-dark",children:"Gastos Totales"}),e.jsxs("span",{className:"text-main-dark font-semibold",children:["$",x.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:`${h.budget-x<0?"bg-main-primary/40":"bg-main-highlight/40"} rounded-3xl p-4 flex justify-between items-center mt-2`,children:[e.jsx("span",{className:"text-main-dark",children:"Saldo Actual"}),e.jsx("span",{className:`${x<0?"text-main-primary":"text-main-dark"} font-semibold`,children:new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(h.budget-x)})]})]}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3 mb-20",children:[e.jsx("h2",{className:"text-main-dark text-lg font-semibold mb-4",children:"Últimos Gastos"}),e.jsx("ul",{className:"space-y-3",children:a.loading?e.jsx(w,{bgTheme:!0}):a.gastos.length>0?e.jsx("ul",{className:"space-y-3",children:a.gastos.sort((t,r)=>r.createdAt-t.createdAt).slice(0,6).map(t=>e.jsx(K,{data:t,onEdit:()=>A(t.year,t.period,t.id),onDelete:()=>E(t.year,t.period,t.id),expandedGastoId:k,onCardClick:C},t.id))}):e.jsx("li",{className:"flex justify-between items-center bg-main-dark/5 rounded-3xl p-4",children:e.jsx("span",{className:"text-main-dark font-medium",children:"No hay gastos registrados"})})})]}),a.isModalOpen&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-lg w-full h-[85vh] relative overflow-hidden",children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:I,className:"p-2 text-main-primary",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:a.isSubmitting,className:"p-2 text-main-highlight rounded hover:bg-main-primary-dark transition",children:a.isSubmitting?"Guardando...":"Agregar"})]}),e.jsxs("div",{className:"px-2",children:[e.jsxs("hgroup",{className:"rounded-3xl py-2 px-4 mb-4 bg-main-light",children:[e.jsx("input",{name:"title",type:"text",placeholder:"Concepto",value:a.title,onChange:p,className:"w-full py-2 bg-transparent outline-none border-b border-main-dark/20 text-main-dark placeholder:text-main-dark/50",required:!0}),e.jsxs("div",{className:"flex-center pt-2 py-2",children:["$",e.jsx("input",{name:"gasto",type:"text",placeholder:"$ $",value:a.gasto,onChange:p,onBlur:$,className:"w-full pl-1 bg-transparent outline-none text-main-dark placeholder:text-main-dark/50",required:!0}),"MXN"]})]}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsxs("select",{name:"type",value:a.type,onChange:p,className:"w-full bg-transparent outline-none",children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Pago con"}),e.jsx("option",{value:"likeU",children:"LikeU"}),e.jsx("option",{value:"AMEX",children:"AMEX"}),e.jsx("option",{value:"cash",children:"Efectivo"})]})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsxs("select",{name:"category",value:a.category,onChange:p,className:"w-full bg-transparent outline-none",children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Categorías"}),e.jsx("option",{value:"feeding",children:"Alimentación y Bebidas"}),e.jsx("option",{value:"transportation",children:"Transporte"}),e.jsx("option",{value:"health",children:"Salud y Bienestar"}),e.jsx("option",{value:"educationJob",children:"Gastos de Educación o Trabajo"}),e.jsx("option",{value:"housing",children:"Vivienda"}),e.jsx("option",{value:"entertainment",children:"Entretenimiento y Ocio"}),e.jsx("option",{value:"personalCare",children:"Ropa y Cuidado Personal"})]})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("input",{id:"date",name:"date",type:"date",value:a.date,onChange:p,className:"w-full bg-transparent outline-none text-main-dark placeholder:text-main-dark/50"})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("input",{name:"file",type:"file",onChange:p,className:"w-full",accept:"image/*, .pdf"})}),e.jsx("textarea",{name:"remarks",placeholder:"Observaciones",value:a.remarks,onChange:p,rows:"4",className:"w-full rounded-3xl p-4 mb-4 outline-none bg-main-light"})]})]})})})]}):null}export{ae as default};
