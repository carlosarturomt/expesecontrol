import{r as u,j as e,I as z,N as L,G as C,v as S,q as f,f as b,d,l as G,w as R,x as $,y as E,z as B,c as O,S as T}from"./index-CrhV-qZD.js";import{u as F}from"./useAuthRequired-DmLmr_bI.js";import{B as H}from"./BackgroundPage-C_stl0pn.js";import{I as y}from"./Input-uIMGSlPX.js";import{a as h}from"./Button-CxzZvKU7.js";const V=()=>{const[o,c]=u.useState({username:"",email:"",password:"",general:""}),[s,g]=u.useState({email:"",password:"",username:""}),[p,k]=u.useState(!1),[U,j]=u.useState(!1),[W,v]=u.useState(""),x=a=>{const{name:t,value:n}=a.target;g(r=>({...r,[t]:n}))},q=async()=>{const a=new C;try{const r=(await S(f,a)).user.email;let i=r.split("@")[0];i.length>15&&(i=i.slice(0,15)),v(i),g(P=>({...P,email:r,username:i})),await w(i)||v(`${i}${Math.floor(Math.random()*1e3)}`),j(!0)}catch(t){console.error("Error autenticando con Google:",t),c(n=>({...n,general:"Hubo un error al registrar con Google."}))}},A=()=>{const a={};return(s.email.length<8||!/\S+@\S+\.\S+/.test(s.email))&&(a.email="Correo electrónico inválido."),s.password.length<8?a.password="La contraseña debe tener al menos 8 caracteres.":/[A-Z]/.test(s.password)?/[a-z]/.test(s.password)?/[0-9]/.test(s.password)?/[!@#$%^&*(),.?":{}|<>]/.test(s.password)||(a.password="La contraseña debe contener al menos un carácter especial."):a.password="La contraseña debe contener al menos un número.":a.password="La contraseña debe contener al menos una letra minúscula.":a.password="La contraseña debe contener al menos una letra mayúscula.",s.username.length<5||s.username.length>20?a.username="El nombre de usuario debe tener entre 5 y 20 caracteres.":s.username.includes(" ")?a.username="El nombre de usuario no puede contener espacios.":/[^a-zA-Z0-9_]/.test(s.username)&&(a.username="El nombre de usuario solo puede contener letras, números y guiones bajos."),c(a),a},D=async a=>{try{return!(await B(O(d,"userAuth"))).docs.some(r=>r.data().email===a)}catch(t){return console.error("Error checking email uniqueness:",t),c(n=>({...n,general:"Error verificando el correo electrónico."})),!1}},w=async a=>{try{const t=b(d,"userData",a);return!(await G(t)).exists()}catch(t){return console.error("Error checking username uniqueness:",t),c(n=>({...n,general:"Error verificando el nombre de usuario."})),!1}},I=async a=>{const{value:t}=a.target;g(r=>({...r,username:t}));const n=await w(t);c(n?r=>({...r,username:""}):r=>({...r,username:"El nombre de usuario ya está en uso."}))},N=async(a,t=!1)=>{var n;if(a.preventDefault(),!t){const r=A();if(Object.keys(r).length>0)return;const l=await D(s.email),i=await w(s.username);if(!l){console.log("El email ya está en uso."),c(m=>({...m,email:"El email ya está en uso."}));return}if(!i){console.log("El usuario ya está en uso."),c(m=>({...m,username:"El nombre de usuario ya está en uso."}));return}}try{let r;if(t){console.log("Autenticación con Google");const i=new C;r=await S(f,i)}else r=await R(f,s.email,s.password);const l=r.user;await $(l,{displayName:s.username}),await E(b(d,`userAuth/${l.uid}`),{uid:l.uid,email:s.email,username:s.username,registrationDate:new Date().toISOString(),providerId:((n=l.providerData[0])==null?void 0:n.providerId)||"password",rol:"user"}),await E(b(d,`userData/${s.username}`),{basicInf:{firstName:"",lastName:"",secondLastName:"",gender:"",birthDate:"",maritalStatus:"",profileDescription:"",website:"",language:"",socialMediaHandles:{twitter:"",linkedin:"",instagram:"",facebook:""}},contactInf:{phoneNumbers:{personal:""},email:s.email,emailPersonal:"",username:s.username,password:s.password,address:{region:"",country:"",mexicoState:"",currentCity:"",nearestAirport:""}},expenseControl:{budget:"",currency:"",cutoffDay:""},paymentTypes:{cash:"cash"},uid:l.uid,registrationDate:new Date().toISOString()}),setTimeout(()=>location.reload(),505)}catch(r){console.error("Error creating user:",r);let l="Ocurrió un error al registrar al usuario.";r.code==="auth/email-already-in-use"?l="El correo electrónico ya está en uso.":r.code==="auth/invalid-email"?l="Correo electrónico inválido.":r.code==="auth/weak-password"?l="La contraseña es demasiado débil.":r.message.includes("network")&&(l="Error de red. Por favor, verifica tu conexión a internet."),c(i=>({...i,general:l}))}},M=a=>{N(a,!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"flex-center flex-col p-6 rounded-xl w-10/12 bg-white",children:[e.jsx("h1",{className:"text-xl font-semibold mb-3 text-main-dark",children:"Registrarse"}),e.jsxs("div",{className:"w-full flex flex-wrap",children:[e.jsx(y,{name:"email",value:s.email,onChange:x,placeholder:"Correo electrónico",type:"email",classIcon:"bg-white/50"}),o.email&&e.jsx("span",{className:"text-sm text-red-600",children:o.email}),e.jsxs("div",{className:"relative w-full",children:[e.jsx(y,{name:"password",value:s.password,onChange:x,placeholder:"Contraseña",type:p?"text":"password",classIcon:"bg-white/50"}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-600",onClick:()=>k(!p),children:p?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z"}),e.jsx("path",{d:"M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299l.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829"}),e.jsx("path",{d:"M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884l-12-12l.708-.708l12 12z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"}),e.jsx("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5a2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0a3.5 3.5 0 0 1-7 0"})]})})]}),o.password&&e.jsx("span",{className:"text-sm text-red-600",children:o.password}),e.jsx(y,{name:"username",value:s.username,onChange:x,placeholder:"Nombre de usuario",type:"text",classIcon:"bg-white/50"}),o.username&&e.jsx("span",{className:"text-sm text-red-600",children:o.username})]}),o.general&&e.jsx("span",{className:"text-sm text-red-600",children:o.general}),e.jsx("div",{className:"w-full mt-3 flex-center",children:e.jsx(h,{text:"Registrarme",onClick:N,className:"w-full",bgColor:"bg-[#212121] hover:bg-[#212121]/70 text-main-light border-2 border-primary-nightshade/70"})}),e.jsx("p",{className:"w-full flex-center",children:"- o -"}),e.jsx("div",{className:"w-full flex flex-wrap",children:e.jsx(h,{text:"Registrarme con Google",onClick:q,bgColor:"bg-white/70 hover:bg-white text-primary-nightshade",className:"w-full border-2 border-primary-nightshade/70",icon:z.logo.google()})}),e.jsxs("p",{className:"text-sm mt-6 mb-3 text-main-dark",children:["¿Tienes una cuenta?",e.jsx(L,{to:"/login",className:"ml-1 font-semibold hover:underline",children:"Iniciar Sesión"})]})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Confirma tu nombre de usuario"}),e.jsx("input",{type:"text",value:s.username,onChange:I,placeholder:"Nombre de usuario",className:"w-full p-2 border border-gray-300 rounded-md"}),o.username&&e.jsx("span",{className:"text-sm text-red-600",children:o.username}),e.jsxs("div",{className:"flex justify-between gap-4 mt-2",children:[e.jsx(h,{text:"Cancelar",onClick:()=>j(!1),bgColor:"bg-gray-200 hover:bg-gray-300",className:"w-1/2"}),e.jsx(h,{text:"Confirmar",onClick:M,disabled:s.username.length<5||o.username,className:`${(s.username.length<5||o.username)&&"bg-gray-400 cursor-not-allowed"} w-1/2`})]})]})})]})},X=()=>{const{isLoading:o,isAuthenticated:c}=F("/register","/");return o?e.jsx(T,{bgTheme:!0}):c?null:e.jsx(H,{children:e.jsx(V,{})})};export{X as default};
