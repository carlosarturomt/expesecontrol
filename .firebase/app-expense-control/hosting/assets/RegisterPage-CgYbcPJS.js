import{r as h,j as e,N as E,v as N,q as k,w as D,x as w,e as p,d as u,y as q,c as A,k as I,S as M}from"./index-DE57Cpbo.js";import{u as P}from"./useAuthRequired-KSE0LA4s.js";import{B as R}from"./BackgroundPage-uDEgNRSB.js";import{I as x}from"./Input-CpI0vRKF.js";import{a as U}from"./Button-B_wAcc2C.js";const z=()=>{const[t,l]=h.useState({username:"",email:"",password:"",general:""}),[a,f]=h.useState({email:"",password:"",username:""}),[d,v]=h.useState(!1),m=s=>{const{name:n,value:i}=s.target;f(c=>({...c,[n]:i}))},y=()=>{const s={};return(a.email.length<8||!/\S+@\S+\.\S+/.test(a.email))&&(s.email="Correo electrónico inválido."),a.password.length<6&&(s.password="La contraseña debe tener al menos 6 caracteres."),(a.username.length<5||a.username.includes(" "))&&(s.username="El nombre de usuario debe tener al menos 5 caracteres y no contener espacios."),l(s),s},j=async s=>{try{return!(await q(A(u,"userAuth"))).docs.some(c=>c.data().email===s)}catch(n){return console.error("Error checking email uniqueness:",n),l(i=>({...i,general:"Error verificando el correo electrónico."})),!1}},b=async s=>{try{const n=p(u,"userData",s);return!(await I(n)).exists()}catch(n){return console.error("Error checking username uniqueness:",n),l(i=>({...i,general:"Error verificando el nombre de usuario."})),!1}},S=async s=>{var g;s.preventDefault();const n=y();if(Object.keys(n).length>0)return;const i=await j(a.email),c=await b(a.username);if(!i){l(o=>({...o,email:"El email ya está en uso."}));return}if(!c){l(o=>({...o,username:"El nombre de usuario ya está en uso."}));return}try{const r=(await N(k,a.email,a.password)).user;await D(r,{displayName:a.username}),await w(p(u,`userAuth/${r.uid}`),{uid:r.uid,email:a.email,username:a.username,registrationDate:new Date().toISOString(),providerId:((g=r.providerData[0])==null?void 0:g.providerId)||"password",rol:"user"}),await w(p(u,`userData/${a.username}`),{basicInf:{firstName:"",lastName:"",secondLastName:"",gender:"",birthDate:"",maritalStatus:"",profileDescription:"",website:"",language:"",socialMediaHandles:{twitter:"",linkedin:"",instagram:"",facebook:""}},contactInf:{phoneNumbers:{personal:""},email:a.email,emailPersonal:"",username:a.username,password:a.password,address:{region:"",country:"",mexicoState:"",currentCity:"",nearestAirport:""}},expenseControl:{budget:"",currency:"",cutoffDay:""},paymentTypes:{cash:"cash"},uid:r.uid,registrationDate:new Date().toISOString()})}catch(o){console.error("Error creating user:",o);let r="Ocurrió un error al registrar al usuario.";o.code==="auth/email-already-in-use"?r="El correo electrónico ya está en uso.":o.code==="auth/invalid-email"?r="Correo electrónico inválido.":o.code==="auth/weak-password"?r="La contraseña es demasiado débil.":o.message.includes("network")&&(r="Error de red. Por favor, verifica tu conexión a internet."),l(C=>({...C,general:r}))}};return e.jsxs("form",{className:"flex-center flex-col p-6 rounded-xl w-10/12 bg-white",children:[e.jsx("h1",{className:"text-xl font-semibold mb-3 text-main-dark",children:"Registrarse"}),e.jsxs("div",{className:"w-full flex flex-wrap",children:[e.jsx(x,{name:"email",value:a.email,onChange:m,placeholder:"Correo electrónico",type:"email",classIcon:"bg-white/50"}),t.email&&e.jsx("span",{className:"text-sm text-red-600",children:t.email}),e.jsxs("div",{className:"relative w-full",children:[e.jsx(x,{name:"password",value:a.password,onChange:m,placeholder:"Contraseña",type:d?"text":"password",classIcon:"bg-white/50"}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-600",onClick:()=>v(!d),children:d?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z"}),e.jsx("path",{d:"M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299l.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829"}),e.jsx("path",{d:"M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884l-12-12l.708-.708l12 12z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"}),e.jsx("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5a2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0a3.5 3.5 0 0 1-7 0"})]})})]}),t.password&&e.jsx("span",{className:"text-sm text-red-600",children:t.password}),e.jsx(x,{name:"username",value:a.username,onChange:m,placeholder:"Nombre de usuario",type:"text",classIcon:"bg-white/50"}),t.username&&e.jsx("span",{className:"text-sm text-red-600",children:t.username})]}),t.general&&e.jsx("span",{className:"text-sm text-red-600",children:t.general}),e.jsx("div",{className:"w-full my-3 flex-center",children:e.jsx(U,{text:"Registrar",onClick:S})}),e.jsx(E,{to:"/login",className:"text-sm text-main-dark hover:underline",children:"Tengo una cuenta"})]})},H=()=>{const{isLoading:t,isAuthenticated:l}=P("/register","/");return t?e.jsx(M,{bgTheme:!0}):l?null:e.jsx(R,{children:e.jsx(z,{})})};export{H as default};
