import{r as d,U as y,j as e,S as N,I as v,c as m,d as u,g as w,a as k,s as S,u as C,b as F,e as E}from"./index-Clm7elC_.js";import{u as M}from"./useAuthRequired-CZrEIka_.js";function A(){const{isLoading:x,isAuthenticated:p}=M("/register","/"),{userAuth:c}=d.useContext(y),[a,i]=d.useState({gastos:[],loading:!0,isModalOpen:!1,gasto:"",title:"",remarks:"",type:"",category:"",file:null,date:new Date().toISOString().substring(0,10),isSubmitting:!1,error:""}),g=()=>i(t=>({...t,isModalOpen:!0})),h=()=>i(t=>({...t,isModalOpen:!1}));d.useEffect(()=>{(async()=>{try{const n=m(u,"userPosts",c.username,"gastos"),r=(await w(n)).docs.map(l=>({id:l.id,...l.data()}));i(l=>({...l,gastos:r,loading:!1}))}catch(n){console.error("Error al obtener los gastos: ",n),i(s=>({...s,loading:!1,error:"Error al obtener los gastos."}))}})()},[c.username]);const f=t=>{const n=t.replace(/[^0-9]/g,"");return n.length===0?"":(parseFloat(n)/100).toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})},o=t=>{const{name:n,value:s}=t.target,r=n==="gasto"?f(s):s;i(l=>({...l,[n]:r}))},b=t=>{const{name:n}=t.target,s=a[n].replace(/[^0-9]/g,""),r=s.length===0?"":parseFloat(s)/100;i(l=>({...l,[n]:r.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}))},j=async t=>{t.preventDefault(),i(s=>({...s,isSubmitting:!0}));const n=parseFloat(a.gasto.replace(/[^0-9.-]+/g,""));try{let s="";if(a.file){const l=k(S,`userFiles/${c.username}/${a.file.name}`);await C(l,a.file),s=await F(l)}const r=m(u,"userPosts",c.username,"gastos");await E(r,{gasto:n,title:a.title,remarks:a.remarks,type:a.type,category:a.category,fileURL:s,user:c.username,createdAt:a.date?new Date(a.date):new Date}),i(l=>({...l,gasto:"",title:"",remarks:"",category:"",file:null,isModalOpen:!1,error:""}))}catch(s){console.error("Error al subir datos: ",s),i(r=>({...r,error:"Error al subir los datos.",isSubmitting:!1}))}finally{i(s=>({...s,isSubmitting:!1}))}};return x||a.loading?e.jsx(N,{bgTheme:!0}):p?e.jsxs("div",{children:[e.jsxs("section",{className:"w-full max-w-screen-sm mt-6 py-3 flex flex-col items-center",children:[e.jsx("p",{className:"text-main-dark/50",children:"Gastos Totales"}),e.jsx("h1",{className:"text-4xl font-bold text-main-dark my-2",children:"$17,505.00"}),e.jsx("p",{className:"text-main-primary",children:"-$7,000.00"})]}),e.jsx("section",{className:"w-full max-w-screen-sm flex justify-between items-center gap-2 py-3 px-6",children:e.jsxs("button",{onClick:g,className:"w-full flex-center gap-1 text-sm font-semibold bg-main-highlight/70 text-white rounded-3xl p-3 transition-colors duration-200 hover:bg-main-primary-dark",children:[e.jsx("i",{className:"flex-center w-6 h-6 rounded-full hover:scale-105",children:v.plus.fill("#FFFFFF")}),"Agregar Gasto"]})}),a.isModalOpen&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-lg w-full h-[95%] relative",children:e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:h,className:"p-2 text-main-primary",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:a.isSubmitting,className:"p-2 text-main-highlight rounded hover:bg-main-primary-dark transition",children:a.isSubmitting?"Guardando...":"Agregar"})]}),e.jsxs("div",{className:"px-2",children:[e.jsxs("hgroup",{className:"rounded-3xl py-2 px-4 mb-4 bg-main-light",children:[e.jsx("input",{name:"title",type:"text",placeholder:"Concepto",value:a.title,onChange:o,className:"w-full py-2 bg-transparent outline-none border-b border-main-dark/20 text-main-dark placeholder:text-main-dark/50",required:!0}),e.jsxs("div",{className:"flex-center pt-2 py-2",children:["$",e.jsx("input",{name:"gasto",type:"text",placeholder:"$ $",value:a.gasto,onChange:o,onBlur:b,className:"w-full pl-1 bg-transparent outline-none text-main-dark placeholder:text-main-dark/50",required:!0}),"MXN"]})]}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsxs("select",{name:"type",value:a.type,onChange:o,className:"w-full bg-transparent outline-none",children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Pago con"}),e.jsx("option",{value:"likeU",children:"LikeU"}),e.jsx("option",{value:"AMEX",children:"AMEX"}),e.jsx("option",{value:"cash",children:"Efectivo"})]})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsxs("select",{name:"category",value:a.category,onChange:o,className:"w-full bg-transparent outline-none",children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Categorías"}),e.jsx("option",{value:"feeding",children:"Alimentación y Bebidas"}),e.jsx("option",{value:"transportation",children:"Transporte"}),e.jsx("option",{value:"health",children:"Salud y Bienestar"}),e.jsx("option",{value:"educationJob",children:"Gastos de Educación o Trabajo"}),e.jsx("option",{value:"housing",children:"Vivienda"}),e.jsx("option",{value:"entertainment",children:"Entretenimiento y Ocio"}),e.jsx("option",{value:"personalCare",children:"Ropa y Cuidado Personal"})]})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("input",{id:"date",name:"date",type:"date",value:a.date,onChange:o,className:"w-full bg-transparent outline-none text-main-dark placeholder:text-main-dark/50"})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("input",{name:"file",type:"file",onChange:o,className:"w-full",accept:"image/*, .pdf"})}),e.jsx("textarea",{name:"remarks",placeholder:"Observaciones",value:a.remarks,onChange:o,rows:"4",className:"w-full rounded-3xl p-4 mb-4 outline-none bg-main-light"})]})]})})}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3",children:[e.jsx("h2",{className:"text-dark text-lg font-semibold mb-4",children:"Notificaciones"}),e.jsx("div",{className:"bg-main-warning rounded-3xl p-4",children:e.jsx("p",{className:"text-dark font-medium",children:"¡Alerta! Has superado tu presupuesto mensual en un 75.05%."})})]}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3",children:[e.jsx("h2",{className:"text-main-dark text-lg font-semibold mb-4",children:"Resumen Mensual"}),e.jsxs("div",{className:"bg-main-dark/5 rounded-3xl p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-main-dark",children:"Presupuesto"}),e.jsx("span",{className:"text-main-dark font-semibold",children:"$10,000.00"})]}),e.jsxs("div",{className:"bg-main-dark/5 rounded-3xl p-4 flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-main-dark",children:"Gastos Totales"}),e.jsx("span",{className:"text-main-dark font-semibold",children:"-$17,505.00"})]}),e.jsxs("div",{className:"bg-main-primary/20 rounded-3xl p-4 flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-main-primary font-semibold",children:"Exceso"}),e.jsx("span",{className:"text-main-primary font-semibold",children:"- $7,505.00 (75.05%)"})]})]}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3 mb-20",children:[e.jsx("h2",{className:"text-main-dark text-lg font-semibold mb-4",children:"Últimos Gastos"}),e.jsx("ul",{className:"space-y-3",children:a.gastos.length>0?a.gastos.map(t=>e.jsxs("li",{className:"flex justify-between items-center bg-main-dark/5 rounded-3xl p-4",children:[e.jsx("span",{className:"text-main-dark font-medium",children:t.title||"Gasto desconocido"}),e.jsxs("span",{className:"text-main-primary font-semibold",children:["-$",t.gasto]})]},t.id)):e.jsx("li",{className:"flex justify-between items-center bg-main-dark/5 rounded-3xl p-4",children:e.jsx("span",{className:"text-main-dark font-medium",children:"No hay gastos registrados"})})})]})]}):null}export{A as default};
