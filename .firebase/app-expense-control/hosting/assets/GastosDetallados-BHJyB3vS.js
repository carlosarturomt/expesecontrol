import{r as c,U as A,j as e}from"./index-pNOXhOLA.js";import{P as F,f as T,C as w,A as E,p as B,a as P,b as L,L as G,c as S,d as k,e as M,B as O}from"./index-2aCvmTlO.js";w.register(E,B,P,L,G,S,k,M,O);function R(){const{state:y,loading:h,userData:t}=c.useContext(A),[i,b]=c.useState([]),[C,N]=c.useState({}),[f,j]=c.useState(null),[u,v]=c.useState("current"),g={card1:t&&t.paymentTypes&&t.paymentTypes.card1,card2:t&&t.paymentTypes&&t.paymentTypes.card2,card3:t&&t.paymentTypes&&t.paymentTypes.card3,card4:t&&t.paymentTypes&&t.paymentTypes.card4,card5:t&&t.paymentTypes&&t.paymentTypes.card5,other:t&&t.paymentTypes&&t.paymentTypes.other,cash:"Efectivo"};return c.useEffect(()=>{var x;if(!t||!y.gastos||h)return;const a=parseInt((x=t==null?void 0:t.expenseControl)==null?void 0:x.cutoffDay,10)||12,n=new Date,m=n.getDate(),d=n.getMonth(),o=n.getFullYear();let l,p;switch(u){case"previous":l=new Date(o,d-1,a),p=new Date(o,d,a-1,23,59,59);break;case"year":l=new Date(o,0,1),p=new Date(o,11,31);break;case"all":b(y.gastos);return;default:l=new Date(o,d-(m<a?1:0),a),p=new Date(l.getFullYear(),l.getMonth()+1,a-1,23,59,59)}const D=y.gastos.filter(s=>{const r=s.createdAt instanceof Date?s.createdAt:s.createdAt.toDate();return r>=l&&r<=p});b(D)},[y.gastos,t,u,h]),c.useEffect(()=>{if(i.length===0){j(null);return}const a=i.reduce((s,r)=>(s[r.category]||(s[r.category]=0),s[r.category]+=parseFloat(r.gasto)||0,s),{}),n={feeding:"Alimentación y Bebidas",transportation:"Transporte",health:"Salud y Bienestar",educationJob:"Gastos de Educación o Trabajo",housing:"Vivienda",entertainment:"Entretenimiento y Ocio",personalCare:"Ropa y Cuidado Personal"},d={labels:Object.keys(a).map(s=>n[s]||s),datasets:[{label:"Gastos por Categoría",data:Object.values(a),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF"]}]},o=i.reduce((s,r)=>(s[r.type]||(s[r.type]=0),s[r.type]+=parseFloat(r.gasto)||0,s),{}),l=Object.keys(o),p=Object.values(o),x={labels:l.map(s=>g[s]||s),datasets:[{label:"Gastos por Tipo de Pago",data:p,backgroundColor:["#495867","#36A2EB","#FFCE56","#4BC0C0","#9966FF"],borderColor:"#fff",borderWidth:1}]};N(x),j(d)},[i]),e.jsxs("section",{className:"container mx-auto p-4 mb-20",children:[e.jsx("h1",{className:"text-xl font-bold mb-4",children:"Detalles de Gastos"}),e.jsx("div",{className:"mb-4",children:e.jsxs("select",{value:u,onChange:a=>v(a.target.value),className:"border p-2 rounded",children:[e.jsx("option",{value:"current",children:"Periodo Actual"}),e.jsx("option",{value:"previous",children:"Periodo Anterior"}),e.jsx("option",{value:"year",children:"Año Actual"}),e.jsx("option",{value:"all",children:"Todos los Gastos"})]})}),e.jsx("div",{className:"flex gap-4 mb-4",children:f?e.jsxs("div",{className:"w-full flex-center flex-col space-y-6",children:[e.jsx("div",{className:"w-full flex-center",children:e.jsx(F,{data:f})}),e.jsx("div",{className:"w-full flex-center",children:e.jsx(T,{data:C})})]}):e.jsx("p",{className:"text-center text-gray-500",children:"Cargando gráficos..."})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Listado de Gastos"}),e.jsxs("table",{className:"w-full table-auto border-collapse ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-sm bg-gray-200",children:[e.jsx("th",{className:"border px-4 py-2",children:"Categoría"}),e.jsx("th",{className:"border px-4 py-2",children:"Monto"}),e.jsx("th",{className:"border px-4 py-2",children:"Fecha"}),e.jsx("th",{className:"border px-4 py-2",children:"Concepto"}),e.jsx("th",{className:"border px-4 py-2",children:"Observaciones"}),e.jsx("th",{className:"border px-4 py-2",children:"Tipo"})]})}),e.jsx("tbody",{children:i.sort((a,n)=>{const m=a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt);return(n.createdAt instanceof Date?n.createdAt:new Date(n.createdAt))-m}).map(a=>e.jsxs("tr",{className:"border-t text-xs",children:[e.jsx("td",{className:"border px-4 py-2",children:a.category}),e.jsxs("td",{className:"border px-4 py-2",children:["$",a.gasto.toFixed(2)]}),e.jsx("td",{className:"border px-4 py-2",children:new Date(a.createdAt).toLocaleDateString()}),e.jsx("td",{className:"border px-4 py-2",children:a.title}),e.jsx("td",{className:"border px-4 py-2",children:a.remarks}),e.jsx("td",{className:"border px-4 py-2",children:g[a.type]||a.type})]},a.id))})]})]})]})}export{R as default};
