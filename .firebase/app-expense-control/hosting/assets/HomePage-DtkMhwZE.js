import{r as m,U as N,j as e,S as y,I as w,c as d,d as u,g as k,a as v,s as S,u as C,b as F,e as M}from"./index-oX9nvym0.js";import{u as $}from"./useAuthRequired-2dJjKYf1.js";function G(){const{isLoading:x,isAuthenticated:g}=$("/register","/"),{userAuth:o}=m.useContext(N),[s,r]=m.useState({gastos:[],loading:!0,isModalOpen:!1,gasto:"",title:"",remarks:"",category:"",file:null,isSubmitting:!1,error:""}),p=()=>r(t=>({...t,isModalOpen:!0})),h=()=>r(t=>({...t,isModalOpen:!1}));m.useEffect(()=>{(async()=>{try{const n=d(u,"userPosts",o.username,"gastos"),i=(await k(n)).docs.map(l=>({id:l.id,...l.data()}));r(l=>({...l,gastos:i,loading:!1}))}catch(n){console.error("Error al obtener los gastos: ",n),r(a=>({...a,loading:!1,error:"Error al obtener los gastos."}))}})()},[o.username]);const f=t=>{const n=t.replace(/[^0-9]/g,"");return n.length===0?"":(parseFloat(n)/100).toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})},c=t=>{const{name:n,value:a}=t.target,i=n==="gasto"?f(a):a;r(l=>({...l,[n]:i}))},b=t=>{const{name:n}=t.target,a=s[n].replace(/[^0-9]/g,""),i=a.length===0?"":parseFloat(a)/100;r(l=>({...l,[n]:i.toLocaleString("es-MX",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}))},j=async t=>{t.preventDefault(),r(a=>({...a,isSubmitting:!0}));const n=parseFloat(s.gasto.replace(/[^0-9.-]+/g,""));try{let a="";if(s.file){const l=v(S,`userFiles/${o.username}/${s.file.name}`);await C(l,s.file),a=await F(l)}const i=d(u,"userPosts",o.username,"gastos");await M(i,{gasto:n,title:s.title,remarks:s.remarks,category:s.category,fileURL:a,user:o.username,createdAt:new Date}),r(l=>({...l,gasto:"",title:"",remarks:"",category:"",file:null,isModalOpen:!1,error:""}))}catch(a){console.error("Error al subir datos: ",a),r(i=>({...i,error:"Error al subir los datos.",isSubmitting:!1}))}finally{r(a=>({...a,isSubmitting:!1}))}};return x||s.loading?e.jsx(y,{bgTheme:!0}):g?e.jsxs("div",{children:[e.jsxs("section",{className:"w-full max-w-screen-sm mt-6 py-3 flex flex-col items-center",children:[e.jsx("p",{className:"text-main-dark/50",children:"Gastos Totales"}),e.jsx("h1",{className:"text-4xl font-bold text-main-dark my-2",children:"$17,505.00"}),e.jsx("p",{className:"text-main-primary",children:"-$7,000.00"})]}),e.jsx("section",{className:"w-full max-w-screen-sm flex justify-between items-center gap-2 py-3 px-6",children:e.jsxs("button",{onClick:p,className:"w-full flex-center gap-1 text-sm font-semibold bg-main-highlight/70 text-white rounded-3xl p-3 transition-colors duration-200 hover:bg-main-primary-dark",children:[e.jsx("i",{className:"flex-center w-6 h-6 rounded-full hover:scale-105",children:w.plus.fill("#FFFFFF")}),"Agregar Gasto"]})}),s.isModalOpen&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-lg w-full h-[95%] relative",children:e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:h,className:"p-2 text-main-primary",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:s.isSubmitting,className:"p-2 text-main-highlight rounded hover:bg-main-primary-dark transition",children:s.isSubmitting?"Guardando...":"Agregar"})]}),e.jsxs("div",{className:"px-2",children:[e.jsxs("hgroup",{className:"rounded-3xl py-2 px-4 mb-4 bg-main-light",children:[e.jsx("input",{name:"title",type:"text",placeholder:"Concepto",value:s.title,onChange:c,className:"w-full py-2 bg-transparent outline-none border-b border-main-dark/20 text-main-dark placeholder:text-main-dark/50",required:!0}),e.jsxs("div",{className:"flex-center pt-2 py-2",children:["$",e.jsx("input",{name:"gasto",type:"text",placeholder:"$ $",value:s.gasto,onChange:c,onBlur:b,className:"w-full pl-1 bg-transparent outline-none text-main-dark placeholder:text-main-dark/50",required:!0}),"MXN"]})]}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsxs("select",{value:s.category,onChange:c,className:"w-full bg-transparent",children:[e.jsx("option",{value:"",hidden:!0,className:"text-main-gray",children:"Categorías"}),e.jsx("option",{value:"feeding",children:"Alimentación y Bebidas"}),e.jsx("option",{value:"transportation",children:"Transporte"}),e.jsx("option",{value:"health",children:"Salud y Bienestar"}),e.jsx("option",{value:"educationJob",children:"Gastos de Educación o Trabajo"}),e.jsx("option",{value:"housing",children:"Vivienda"}),e.jsx("option",{value:"entertainment",children:"Entretenimiento y Ocio"}),e.jsx("option",{value:"personalCare",children:"Ropa y Cuidado Personal"})]})}),e.jsx("div",{className:"rounded-3xl p-4 mb-4 bg-main-light",children:e.jsx("input",{name:"file",type:"file",onChange:c,className:"w-full",accept:"image/*, .pdf"})}),e.jsx("textarea",{name:"remarks",placeholder:"Observaciones",value:s.remarks,onChange:c,rows:"4",className:"w-full rounded-3xl p-4 mb-4 outline-none bg-main-light"})]})]})})}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3",children:[e.jsx("h2",{className:"text-dark text-lg font-semibold mb-4",children:"Notificaciones"}),e.jsx("div",{className:"bg-main-warning rounded-3xl p-4",children:e.jsx("p",{className:"text-dark font-medium",children:"¡Alerta! Has superado tu presupuesto mensual en un 75.05%."})})]}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3",children:[e.jsx("h2",{className:"text-main-dark text-lg font-semibold mb-4",children:"Resumen Mensual"}),e.jsxs("div",{className:"bg-main-dark/5 rounded-3xl p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-main-dark",children:"Presupuesto"}),e.jsx("span",{className:"text-main-dark font-semibold",children:"$10,000.00"})]}),e.jsxs("div",{className:"bg-main-dark/5 rounded-3xl p-4 flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-main-dark",children:"Gastos Totales"}),e.jsx("span",{className:"text-main-dark font-semibold",children:"-$17,505.00"})]}),e.jsxs("div",{className:"bg-main-primary/20 rounded-3xl p-4 flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-main-primary font-semibold",children:"Exceso"}),e.jsx("span",{className:"text-main-primary font-semibold",children:"- $7,505.00 (75.05%)"})]})]}),e.jsxs("section",{className:"w-full max-w-screen-sm py-3 mb-20",children:[e.jsx("h2",{className:"text-main-dark text-lg font-semibold mb-4",children:"Últimos Gastos"}),e.jsx("ul",{className:"space-y-3",children:s.gastos.length>0?s.gastos.map(t=>e.jsxs("li",{className:"flex justify-between items-center bg-main-dark/5 rounded-3xl p-4",children:[e.jsx("span",{className:"text-main-dark font-medium",children:t.title||"Gasto desconocido"}),e.jsxs("span",{className:"text-main-primary font-semibold",children:["-$",t.gasto]})]},t.id)):e.jsx("li",{className:"flex justify-between items-center bg-main-dark/5 rounded-3xl p-4",children:e.jsx("span",{className:"text-main-dark font-medium",children:"No hay gastos registrados"})})})]})]}):null}export{G as default};
